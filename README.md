# MarketPlace - Десктопное приложение маркетплейса

![Qt](https://img.shields.io/badge/Qt-6.0+-green.svg)
![C++](https://img.shields.io/badge/C++-17-blue.svg)
![Platform](https://img.shields.io/badge/Platform-Windows%20%7C%20Linux%20%7C%20macOS-lightgrey.svg)
![License](https://img.shields.io/badge/License-MIT-blue.svg)

Десктопное приложение для электронной коммерции, созданное с использованием **Qt 6** и **C++17**. Приложение имитирует функциональность маркетплейса, похожего на Wildberries, с поддержкой тем, корзиной покупок и панелью администратора.

---

## Содержание

- [Особенности](#особенности)
- [Скриншоты](#скриншоты)
- [Структура проекта](#структура проекта)
- [Требования](#требования)
- [Установка и сборка](#установка-и-сборка)
- [Архитектура](#архитектура)
- [Описание модулей](#описание-модулей)
- [Темы](#темы)
- [База данных](#база-данных)
- [Для разработчиков](#для-разработчиков)
- [Список изменений](#список-изменений)
- [Планы на будущее](#планы-на-будущее)
- [Участие в разработке](#участие-в-разработке)
- [Лицензия](#лицензия)

---

## Особенности

### Для покупателей
- Регистрация и аутентификация пользователей
- Каталог товаров с категориями
- Функциональность поиска товаров
- Корзина с управлением количеством
- Личный профиль с балансом
- Выбор темы (Светлая / Темная / Wildberries)

### Для администраторов
- Добавление новых товаров
- Редактирование существующих товаров
- Удаление товаров
- Управление запасами

### Технические особенности
- Семантика перемещения (move semantics) для оптимизации производительности
- Индексация на основе хэшей для быстрого поиска
- Безопасные для памяти компоненты интерфейса (отсутствие утечек памяти при эффектах наведения)
- Корректное использование `const` во всей кодовой базе
- Спецификации `noexcept` там, где это применимо

---

## Скриншоты

Скриншоты можно добавить в директорию `docs/screenshots/`.

---

## Структура проекта

```
wild/
|-- include/                 # Заголовочные файлы (.h)
|   |-- core/                # Ядро приложения
|   |   |-- database.h       # Класс управления данными
|   |   +-- theme_manager.h  # Менеджер тем (синглтон)
|   |-- models/              # Модели данных
|   |   |-- user.h           # Модель пользователя
|   |   |-- product.h        # Модель товара
|   |   +-- cart.h           # Модель корзины
|   +-- ui/                  # Пользовательский интерфейс
|       |-- mainwindow.h     # Главное окно
|       |-- loginwindow.h    # Окно входа
|       |-- registerwindow.h # Окно регистрации
|       |-- adminpanel.h     # Панель администратора
|       |-- cartwidget.h     # Виджет корзины
|       |-- profilewidget.h  # Виджет профиля
|       +-- productcard.h    # Карточка товара
|
|-- src/                     # Исходные файлы (.cpp)
|   |-- main.cpp             # Точка входа
|   |-- core/                # Реализация ядра
|   |-- models/              # Реализация моделей
|   +-- ui/                  # Реализация интерфейса
|
|-- forms/                   # Формы Qt Designer (.ui)
|   +-- mainwindow.ui
|
|-- resources/               # Ресурсы приложения
|   +-- styles/              # Таблицы стилей QSS
|       |-- style_light.qss  # Светлая тема
|       |-- style_dark.qss   # Темная тема
|       |-- style_wb.qss     # Тема Wildberries
|       +-- styles.qrc       # Файл ресурсов Qt
|
|-- data/                    # Данные приложения (создаются во время выполнения)
|   |-- users.txt            # Файл данных пользователей
|   +-- products.txt         # Файл данных товаров
|
|-- docs/                    # Документация
|   +-- screenshots/         # Скриншоты
|
|-- build/                   # Директория сборки (не фиксировать в Git!)
|
|-- wild.pro                 # Проектный файл Qt
|-- .gitignore               # Правила игнорирования Git
+-- README.md                # Этот файл
```

---

## Требования

| Компонент | Минимальная версия |
|-----------|--------------------|
| Qt | 6.0+ |
| Компилятор C++ | C++17 (GCC 8+ / MSVC 2019+ / Clang 7+) |
| qmake | 6.0+ |

### Зависимости Qt
- Qt Core
- Qt Gui
- Qt Widgets

---

## Установка и сборка

### Способ 1: Qt Creator (Рекомендуется)

1. Откройте Qt Creator
2. **Файл** -> **Открыть файл или проект**
3. Выберите `wild.pro`
4. Настройте комплект сборки (Kit) с Qt 6
5. Нажмите **Ctrl+R** для сборки и запуска

### Способ 2: Командная строка (qmake)

```bash
# Клонируйте репозиторий
git clone <repository-url>
cd wild

# Создайте директорию сборки
mkdir build && cd build

# Сгенерируйте Makefile
qmake ../wild.pro

# Соберите проект
make -j$(nproc)   # Linux/macOS
# или
mingw32-make      # Windows с MinGW
# или
nmake             # Windows с MSVC

# Запуск
./wild            # Linux/macOS
wild.exe          # Windows
```

### Способ 3: Командная строка (CMake)

Если добавлен CMakeLists.txt:

```bash
mkdir build && cd build
cmake ..
cmake --build . --config Release
```

---

## Архитектура

Проект следует архитектуре **MVC** (Model-View-Controller) с разделением слоев:

```
+----------------------------------------------------------+
|                      Слой интерфейса                     |
|   (MainWindow, LoginWindow, ProductCard, CartWidget...)   |
+----------------------------------------------------------+
|                        Слой ядра                         |
|              (Database, ThemeManager)                     |
+----------------------------------------------------------+
|                      Слой моделей                        |
|                (User, Product, Cart)                      |
+----------------------------------------------------------+
|                   Хранилище данных                       |
|                  (файлы data/*.txt)                       |
+----------------------------------------------------------+
```

---

## Описание модулей

### Ядро (Core)

#### Database
Класс для управления данными пользователей и товаров с индексированным поиском.

```cpp
Database db("data/");

// Аутентификация
User* user = db.authenticateUser("username", "password");

// Регистрация (с кодом админа для роли администратора)
db.registerUser("user", "pass", "email@test.com", "ADMIN_CODE");

// Операции с товарами
const auto& products = db.getAllProducts();
auto electronics = db.getProductsByCategory("Electronics");
auto found = db.searchProducts("smartphone");
```

**Ключевые оптимизации:**
- Индексы на основе хэшей для поиска пользователей/товаров по ID за O(1)
- Индексы имен пользователей и email для быстрой аутентификации
- "Ленивое" сохранение с флагом изменений (dirty flag)

#### ThemeManager
Синглтон для управления темами приложения.

```cpp
// Получение экземпляра
ThemeManager& tm = ThemeManager::instance();

// Применение темы
tm.applyTheme(ThemeType::Dark);

// Получение текущей темы
ThemeType current = tm.currentTheme();

// Подписка на изменения
connect(&tm, &ThemeManager::themeChanged, this, &MyClass::onThemeChanged);
```

### Модели (Models)

#### User
Модель пользователя с ролями (Покупатель/Админ).

| Поле | Тип | Описание |
|------|-----|----------|
| m_id | int | Уникальный идентификатор |
| m_username | string | Имя пользователя |
| m_password | string | Пароль |
| m_email | string | Адрес электронной почты |
| m_phone | string | Номер телефона |
| m_address | string | Адрес доставки |
| m_balance | double | Баланс аккаунта |
| m_role | UserRole | Роль (Customer/Admin) |

#### Product
Модель товара.

| Поле | Тип | Описание |
|------|-----|----------|
| m_id | int | Уникальный идентификатор |
| m_name | string | Название товара |
| m_description | string | Описание |
| m_category | string | Категория |
| m_brand | string | Бренд |
| m_price | double | Цена |
| m_oldPrice | double | Старая цена (для скидок) |
| m_discount | int | Процент скидки |
| m_stock | int | Количество на складе |
| m_rating | double | Рейтинг (0-5) |

#### Cart
Корзина покупок с методами управления товарами.

```cpp
Cart cart(userId);
cart.addItem(product, 2);           // Добавить 2 единицы
cart.updateQuantity(productId, 5);  // Изменить количество
cart.removeItem(productId);         // Удалить товар
double total = cart.getTotalPrice();
```

### Компоненты интерфейса (UI Components)

| Виджет | Описание |
|--------|----------|
| MainWindow | Главное окно с навигацией и каталогом |
| LoginWindow | Форма входа |
| RegisterWindow | Форма регистрации |
| AdminPanel | Панель администратора для управления товарами |
| CartWidget | Виджет корзины с итогами |
| ProfileWidget | Профиль пользователя |
| ProductCard | Карточка товара в каталоге |

---

## Темы

Приложение поддерживает 3 темы:

| Тема | Файл | Описание |
|------|------|----------|
| Светлая | style_light.qss | Классическая светлая тема |
| Темная | style_dark.qss | Темный режим для комфортной работы |
| Wildberries | style_wb.qss | Фирменный стиль в цветах WB |

Тема сохраняется в `QSettings` и загружается при следующем запуске.

### Добавление новой темы

1. Создайте файл `resources/styles/style_mytheme.qss`
2. Добавьте его в `styles.qrc`
3. Добавьте новое значение в `enum class ThemeType`
4. Обновите методы в `ThemeManager`

---

## База данных

Данные хранятся в текстовых файлах в папке `data/`:

- `users.txt` - Сериализованные данные пользователей
- `products.txt` - Сериализованные данные товаров

Демонстрационные товары создаются при первом запуске.

### Секретный код администратора

Чтобы зарегистрироваться с правами администратора, используйте секретный код во время регистрации. Код определен в `database.cpp` в константе `ADMIN_SECRET_CODE`.

**Код админа по умолчанию:** `ADMIN2024SECRET`

---

## Для разработчиков

### Стиль кода

- Именование переменных-членов класса: `m_variableName`
- Используйте `nullptr` вместо `NULL`
- Используйте `const` и `noexcept` там, где это применимо
- Предпочитайте `const auto&` для переменных цикла
- Используйте структурированные привязки: `for (const auto& [id, item] : map)`

### Полезные команды

```bash
# Очистка сборки
make clean

# Пересборка
make clean && make -j$(nproc)

# Запуск с отладочным выводом Qt
QT_DEBUG_PLUGINS=1 ./wild
```

### Добавление нового виджета

1. Создайте заголовочный файл в `include/ui/`
2. Создайте файл реализации в `src/ui/`
3. Добавьте пути в `wild.pro`
4. Если нужна форма — создайте `.ui` в `forms/`

### Git Workflow

Не фиксируйте:
- `build/`
- `*.pro.user`
- `data/*.txt` (данные пользователей)

---

## Список изменений

### Версия 1.0.0 (Январь 2024)

#### Добавлено
- Начальный релиз
- Система аутентификации и регистрации пользователей
- Каталог товаров с категориями
- Функциональность корзины покупок
- Профиль пользователя с управлением балансом
- Панель администратора для CRUD-операций с товарами
- Три темы: Светлая, Темная, Wildberries
- Сохранение темы через QSettings

#### Оптимизации
- Семантика перемещения для классов User, Product и Cart
- Индексация на основе хэшей в Database для поиска за O(1)
- Исправлена утечка памяти в эффектах наведения ProductCard (повторное использование эффекта тени)
- Добавлены спецификации `noexcept`
- Иконки-эмодзи заменены текстовыми плейсхолдерами
- Улучшена сериализация/десериализация с обработкой ошибок
- Добавлена валидация ввода во всех формах

#### Исправлено
- CartWidget теперь корректно обновляется при смене указателя на Cart
- ProfileWidget корректно обрабатывает обновления указателя на пользователя
- Database правильно перестраивает индексы после удаления товара
- Поля форм теперь имеют правильную навигацию клавишей Enter

#### Изменено
- Текст интерфейса изменен с русского на английский (примечание: теперь переведен обратно на русский в комментариях и README)
- Удалены все символы эмодзи из кода
- Улучшены сообщения об ошибках и обратная связь для пользователя

---

## TODO / Планы на будущее

- [ ] Добавить поддержку изображений товаров
- [ ] Реализовать историю заказов
- [ ] Добавить систему отзывов/рейтингов
- [ ] Перейти на базу данных SQLite
- [ ] Добавить модульные тесты (unit tests)
- [ ] Реализовать фильтры по цене и рейтингу
- [ ] Добавить пагинацию для больших списков товаров
- [ ] Реализовать хэширование паролей

---

## Участие в разработке

1. Сделайте форк репозитория
2. Создайте ветку для новой функции (`git checkout -b feature/amazing-feature`)
3. Зафиксируйте изменения (`git commit -m 'Add amazing feature'`)
4. Отправьте ветку в удаленный репозиторий (`git push origin feature/amazing-feature`)
5. Откройте Pull Request

### Рекомендации для Pull Request

- Следуйте существующему стилю кода
- Добавляйте тесты для новой функциональности
- Обновляйте документацию при необходимости
- Делайте коммиты атомарными и с хорошим описанием

---

## Лицензия

Этот проект распространяется под лицензией MIT. Подробности см. в файле `LICENSE`.

---

## Контакты

Если у вас есть вопросы по проекту, создайте Issue в репозитории.

---

## Благодарности

- Qt Framework - https://www.qt.io/

---

Создано с помощью Qt и C++17